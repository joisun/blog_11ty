---
title: JSé«˜ç¨‹ - JavaScriptä¸­çš„RegExpå¯¹è±¡
date: 2021-11-23
tags:
  - RegExp
  - æ­£åˆ™è¡¨è¾¾å¼
---

[TOC]

## 1. RegExp

ECMAScript é€šè¿‡RegExpç±»å‹æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚

### 1.1 è¡¨ç¤ºæ ¼å¼ï¼š

```javascript
let expression = /pattern/flags;
//or
let expression = new RegExp("pattern str","flags")// pattern str ä¸éœ€è¦ç”±"/.../"åŒ…è£¹ï¼Œ
```

- pattern : æ­£åˆ™è¡¨è¾¾å¼ï¼›
- flags : åŒ¹é…æ¨¡å¼çš„æ ‡è®°ï¼›

> ç¤ºä¾‹ï¼š
>
> ```javascript
> let expression = /[bc]at/i;
> //or
> let expression = new RegExp("[bc]at","i"); // æ³¨æ„æ„é€ å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯String, ä¸”æ— éœ€`/`åŒ…è£¹
> ```

> **æ³¨æ„ï¼š** åœ¨é€šè¿‡æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªPattern çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé™¤äº†å¯ä»¥ä¼ å…¥String, è¿˜èƒ½ç›´æ¥ä¼ å…¥ä¸€ä¸ªå·²æœ‰çš„Pattern ï¼Œ æ­¤æ—¶ï¼Œæ„é€ å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³Flags å°†ä¼šè¦†ç›–ç¬¬ä¸€ä¸ªå‚æ•°ä¸­æºå¸¦çš„flagsã€‚ åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼Œå¯ä»¥å®ç°Pattern çš„å¤åˆ¶ å’Œ flags çš„ä¿®æ”¹ï¼Œ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š
>
> ```javascript
> const exp1 = /cat/
> const exp2 = new RegExp(exp1, 'i') //  /cat/i
> ```

### 1.2 åŒ¹é…æ¨¡å¼ï¼š

> "Gimyus"

- g : global , å…¨å±€åŒ¹é…
- i : ignore , å¤§å°å†™å¿½ç•¥
- m : multiline , å¤šè¡ŒåŒ¹é…
- y : sticky ç²˜é™„æ¨¡å¼ï¼Œè¡¨ç¤ºä»lastIndexå¼€å§‹æŸ¥æ‰¾
- u : Unicode æ¨¡å¼ï¼Œ å¯ç”¨Unicode åŒ¹é…
- s : dotAll æ¨¡å¼ï¼ŒåŒ¹é…ä»»ä½•å­—ç¬¦ï¼ˆåŒ…æ‹¬\næˆ–\rï¼‰

> å…¨å±€åŒ¹é…å’Œå¤šè¡ŒåŒ¹é…æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
>
> å¯ä»¥ç†è§£ä¸ºï¼Œ`/m` é€šå¸¸æ˜¯å’Œ`/g` ä¸€èµ·ä½¿ç”¨ä»¥å¢å¼ºåŒ¹é…æ¨¡å¼ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š
>
> ```
> hello my darling you
> are so sweat
> and hello my beauty
> hello my lady
> you are so kind
> hello my heartbeat
> you drum like a spring wind
> ```
>
> - åŒ¹é…æ¨¡å¼ `/^hello/g` : å°†ä¼šä»¥æ•´ä¸ªå­—ç¬¦ä¸²ä¸ºåŒ¹é…å¯¹è±¡ï¼Œä»…ä»…åŒ¹é…ä¸­å­—ç¬¦ä¸²é¦–éƒ¨çš„å•ä¸ªâ€œhelloâ€ å­å­—ç¬¦ä¸²ã€‚
> - åŒ¹é…æ¨¡å¼ `/^hello/gm`ï¼šå°†ä¼šæŠŠæ¯è¡Œè‡ªä½œå•ç‹¬çš„åŒ¹é…å¯¹è±¡ï¼Œå°†ä¼šåŒ¹é…é€‰ä¸­ 1,4,6 è¡Œé¦–çš„â€œhelloâ€ å­å­—ç¬¦ä¸²ï¼Œå…±ä¸‰ä¸ªã€‚

unicode æ¨¡å¼ï¼Œå°†ä¼šå¯ç”¨Unicode å­—ç¬¦åŒ¹é…çš„æ”¯æŒï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

```javascript
const sentence = 'A ticket to å¤§é˜ª costs Â¥2000 ğŸ‘Œ.'

const regexpEmojiPresentation = /\p{Emoji_Presentation}/gu
console.log(sentence.match(regexpEmojiPresentation))
// expected output: Array ["ğŸ‘Œ"]
```

dotAll æ¨¡å¼ï¼Œ é»˜è®¤æƒ…å†µä¸‹ï¼Œdot `.` èƒ½å¤ŸåŒ¹é…ä¸åŒ…æ‹¬ `\n`ï¼ˆæ¢è¡Œï¼‰,`\r`ï¼ˆå…‰æ ‡å›åˆ°è¡Œé¦–ï¼‰ï¼Œä¹‹å¤–çš„ä»»æ„å­—ç¬¦ã€‚

å½“ä½ æ‰€åŒ¹é…çš„å­—ç¬¦ä¸²ä¸­å«æœ‰è¿™ä¸¤ä¸ªå…ƒå­—ç¬¦æ—¶ï¼Œ å¦‚æœä¸å¼€å¯dotAll æ¨¡å¼ï¼Œå°†ä¸ä¼šè¢«åŒ¹é…åˆ°ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

[MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/dotAll])ä¸Šæœ‰è¿™æ ·ä¸€ä¸ªdemo:

```javascript
const str1 = 'bar\nexample foo example'

const regex1 = new RegExp('bar.example', 's')

console.log(regex1.dotAll) // Output: true

console.log(str1.replace(regex1, '')) // Output: foo example

const str2 = 'bar\nexample foo example'

const regex2 = new RegExp('bar.example')

console.log(regex2.dotAll) // Output: false

console.log(str2.replace(regex2, '')) // Output: bar
//         example foo example
```

![image-20211122191528475](./assets/image-20211122191528475.png)

### 1.3 RegExp å®ä¾‹å±æ€§

gimyus åŒ¹é…æ¨¡å¼æ˜¯å¦å¼€å¯ï¼Œé™¤äº†åœ¨åˆ›å»ºå®ä¾‹å¯¹è±¡æ—¶å»æŒ‡å®šï¼Œè¿˜å¯ä»¥é€šè¿‡RegExp å®ä¾‹çš„å±æ€§è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥è®¾å®šå€¼ï¼Œä½†æ˜¯æ³¨æ„ï¼ŒdotAll åŒ¹é…æ¨¡å¼é™¤å¤–ï¼Œ å®ƒæ˜¯ä¸€ä¸ªåªè¯»å±æ€§ã€‚ ä½ åªèƒ½åœ¨åˆ›å»ºä¸€ä¸ªRegExp å®ä¾‹çš„æ—¶å€™å»è®¾å®šå¥½å®ƒã€‚

å¦‚ï¼š

```javascript
const exp0 = /[bc]at/
// or
const exp1 = new RegExp('[bc]at', '')
// or å¦‚æœæœ‰éœ€è¦ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥å¤åˆ¶æ‹“å±•ä¸€ä¸ªå·²æœ‰çš„å®ä¾‹
const exp2 = /[bc]at/
const exp22 = new RegExp(exp2, '')
```

é™¤äº†è¿™äº›boolean ç±»å‹çš„å±æ€§ï¼Œè¿˜æœ‰ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«æ˜¯ï¼š

1. `source` : æ­£åˆ™è¡¨è¾¾å¼çš„å­—é¢é‡å­—ç¬¦ä¸²ï¼›
2. `flags` : æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼æ ‡è®°å­—ç¬¦ä¸²ï¼›
3. `lastIndex` : æ•´æ•°ç±»å‹ï¼Œè®°å½•äº†åœ¨æºå­—ç¬¦ä¸²ä¸­ä¸‹ä¸€æ¬¡æœç´¢çš„èµ·å§‹ä½ç½®(åé¢ä¼šè®²åˆ°)

```javascript
const exp0 = /[bc]at/g
console.log(exp0.source)// "[bc]at"
console.log(exp0.flags)// "gms"
```

### 1.4 RegExp å®ä¾‹æ–¹æ³•

#### 1.4.1 `exec()`

##### 1.4.1.1 åŸºæœ¬ç”¨æ³•

`exec()` ä¸»è¦ç”¨äºé…åˆæ•è·ç»„ä½¿ç”¨ï¼Œ åªæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå³è¦åŒ¹é…çš„ç›®æ ‡å­—ç¬¦ä¸²ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…åˆ™è¿”å›`null` ï¼Œ åŒ¹é…åˆ™è¿”å›åŒ…å«<span style="color:red">ç¬¬ä¸€ä¸ª</span>åŒ¹é…ä¿¡æ¯çš„æ•°ç»„ã€‚

```javascript
RegExpPattern.exec('target string...')
```

> :warning: æ³¨æ„: è¯¥æ–¹æ³•è¿”å›çš„æ•°æ®ç±»å‹è™½ç„¶æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ ä½†æ˜¯å®ƒæ¯”è¾ƒç‰¹æ®Šï¼Œ å®ƒåŒ…å«äº†ä¸¤ä¸ªé¢å¤–çš„å±æ€§ï¼š
>
> 1. `index` : å­—ç¬¦ä¸²ä¸­åŒ¹é…æ¨¡å¼çš„èµ·å§‹å¤–ç½®ï¼›
> 2. `input` ï¼šè¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²ï¼›

æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯åŒ¹é…æ•´ä¸ªæ¨¡å¼çš„å­—ç¬¦ä¸²ï¼Œ å…¶ä»–çš„å…ƒç´ æ˜¯ä¸è¡¨è¾¾å¼ä¸­çš„æ•è·ç»„åŒ¹é…çš„å­å­—ç¬¦ä¸²ã€‚ å¦‚æœæ¨¡å¼ä¸­å¹¶æ²¡æœ‰æ•è·ç»„çš„èŠ±ï¼Œé‚£ä¹ˆæ•°ç»„å€¼åŒ…å«ä¸€ä¸ªå…ƒç´ ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š

**ä¸åŒ…å«æ•è·ç»„çš„æƒ…å†µ**

```javascript
const str = 'I always love the moment you smile'
const exp = /love the moment/
const result = exp.exec(str);
// result
['love the moment']
```

å®é™…ä¸Šï¼Œè¿˜æœ‰åˆšæ‰è¯´çš„å‡ ä¸ªç‰¹æ®Šå±æ€§,å¦‚æœä½ åœ¨console å°æŸ¥çœ‹ result :

![image-20211122195056548](./assets/image-20211122195056548.png)

**åŒ…å«æ•è·ç»„çš„æƒ…å†µ**

```javascript
const str = 'I always love the moment you smile'
const exp = /always (love (the moment (you)) smile)/
const result = exp.exec(str);
// result
[
  'always love the moment you smile',
  'love the moment you smile',
  'the moment you',
  'you'
]
```

![image-20211122195925150](./assets/image-20211122195925150.png)

##### 1.4.1.2 `exec()` å’Œ `\g` åŒ¹é…æ¨¡å¼

ä¸”çœ‹è¿™æ ·ä¸€ä¸ªç¤ºä¾‹ï¼š

![image-20211122200608818](./assets/image-20211122200608818.png)

å½“ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æœ‰å¤šå¤„è¢«Pattern æ‰€åŒ¹é…æ—¶ï¼Œ è®¾å®šäº†`/g` çš„åŒ¹é…æ¨¡å¼å’Œ ä¸è®¾å®šæ—¶çš„ç»“æœå­˜åœ¨å·®å¼‚ã€‚

å³ï¼Œ å¦‚æœä¸è®¾å®š`\g` ï¼Œé‚£ä¹ˆä¸è®º`exec()` æ‰§è¡Œäº†å¤šå°‘æ¬¡ï¼Œ è¿”å›ç»“æœå§‹ç»ˆåªä¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„ç»“æœã€‚ çœ‹èµ·æ¥ï¼Œå°±åƒæ˜¯ï¼Œæ¯æ¬¡éƒ½æ˜¯é‡æ–°åŒ¹é…ï¼Œ ä¸”åŒ¹é…åˆ°äº†ä¸€ä¸ªç»“æœä¹‹åå°±é€€å‡ºäº† ï¼Œä¸åšè®°å½•ã€‚

è€Œå¦‚æœè®¾å®šäº†`/g` , é‚£ä¹ˆå°±ä¼šæ¯æ¬¡æ‰§è¡Œå°†ä¼šè¿”å›ä¸€ä¸ªæ–°çš„åŒ¹é…åˆ°çš„ å­ä¸²ç»“æœï¼Œ ç›´åˆ°æ²¡æœ‰åŒ¹é…é¡¹ï¼Œè¿”å›`null` ä¸ºæ­¢ï¼Œ çœ‹èµ·æ¥ï¼Œå°±åƒæ˜¯æ¯æ¬¡æ‰§è¡Œéƒ½è®°å½•äº†ä¸‹ä¸€æ¬¡é¢„å°†æ‰§è¡Œçš„ç´¢å¼•å€¼ä½ç½®ï¼Œ è¿™ä¸ªå€¼å®é™…ä¸Šå°±æ˜¯ RegExpçš„å®ä¾‹å±æ€§`lastIndex`

![image-20211123085726210](./assets/image-20211123085726210.png)

æ³¨æ„ï¼Œç›´æ¥ç»“æœä¸ºnull ä¹‹åï¼ŒlastIndex å€¼è¢«é‡æ–°ç½®0ï¼Œ è¿™æ„å‘³ç€å¦‚æœç»§ç»­æ‰§è¡Œ`exec()` æ–¹æ³•ï¼Œé‚£ä¹ˆä¼šé‡æ–°å¼€å§‹ã€‚

##### 1.4.1.3 `exec()` å’Œ `\y` é»ç€åŒ¹é…æ¨¡å¼

å¦‚æœä½ ä»”ç»†è§‚å¯Ÿ`\g`åŒ¹é…æ¨¡å¼ï¼Œä¸éš¾å‘ç°ï¼Œè¯¥æ¨¡å¼æ¯æ¬¡è¿”å›çš„`lastindex` å€¼ +1 åï¼Œå°±æ­£å¥½æ˜¯ä¸‹ä¸€ä¸ªåŒ¹é…å­—ç¬¦çš„èµ·å§‹ä½ç½®ã€‚ ç›¸å½“çš„â€œæ™ºèƒ½â€ã€‚

`\y` æ¨¡å¼ï¼Œåˆ™ä¸åŒï¼Œå®ƒä½¿å¾—ä½ åœ¨æ¯æ¬¡`exec()` æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œéƒ½éœ€è¦å…ˆæ˜ç¡®ä¸‹ä¸€ä¸ªå­ä¸²åŒ¹é…çš„èµ·å§‹ç´¢å¼•ã€‚å¹¶ä¸ä¼šè‡ªåŠ¨ä¸ºä½ æ›´æ–° lastIndexå€¼ä¸ºä¸‹ä¸€ä¸ªåŒ¹é…å­—ç¬¦çš„æ­£ç¡®ä½ã€‚

![image-20211123105424080](./assets/image-20211123105424080.png)

> é¦–æ¬¡åŒ¹é…ï¼Œå°†ä»index = 0 çš„ä½ç½®åŒ¹é…ï¼Œä½†æ˜¯åŒ¹é…ä¸åˆ°æ‰€ä»¥è¿”å›null, ä¸”æ°¸è¿œä¸ä¼šå°†lastIndex è®¾å®šä¸ºä¸‹ä¸€æ¬¡æ­£ç¡®åŒ¹é…æ‰€åœ¨çš„ä½ç½®ï¼Œ ä½†æ˜¯å¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ­£ç¡®çš„lastIndex å€¼ï¼Œä¸è¿‡ï¼Œè¿™æ¬¡åŒ¹é…æˆåŠŸäº†ï¼Œè¿”å›äº†æ­£å¸¸çš„ç»“æœï¼Œè€ŒlastIndex è¢«åˆ·æ–°ä¸ºäº†ä¸‹ä¸€ä¸ªéç©ºå­—ç¬¦æ‰€åœ¨çš„ç´¢å¼•å€¼ï¼Œ ä¾æ—§ä¸ä¼šæ˜¯ä¸‹ä¸€æ¬¡æ­£ç¡®åŒ¹é…çš„ç´¢å¼•ï¼Œå¦‚æœæƒ³è¦èƒ½åŒ¹é…åˆ°ï¼Œè¿˜æ˜¯è¦æ‰‹åŠ¨æŒ‡å®šå…¶ç´¢å¼•å€¼ - -
>
> > æ˜¯ä¸æ˜¯å¾ˆæ— è¯­ - - ï¼Œ æˆ‘éƒ½çŸ¥é“äº†åŒ¹é…é¡¹æ‰€åœ¨ä½ç½®ï¼Œæˆ‘è¿˜tméœ€è¦ç”¨ä½ æ¥å¹²å•¥ï¼Ÿ
> > è¿™ä¸ªæ¨¡å¼å¾ˆå°‘ä¼šç”¨ï¼Œå¯èƒ½æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹æ‰æœ‰ç”¨å§ï¼Œä¾‹å¦‚éå†å­—ç¬¦ä¸²ï¼Œå…¶ä¸æ–­åˆ·æ–°lastIndexå€¼ ï¼Ÿæˆ–è€…çŸ¥é“äº†ç´¢å¼•ä½å»å–å¯¹åº”çš„åŒ¹é…é¡¹ï¼Ÿ

![image-20211123110607828](./assets/image-20211123110607828.png)

> è€Œ `\g ` åŒ¹é…æ¨¡å¼åˆ™å®Œå…¨ä¸åŒï¼Œ æ¯æ¬¡åŒ¹é…åéƒ½ä¼šåˆ·æ–°lastIndex çš„å€¼ã€‚

#### 1.4.2 `test()`

```javascript
Pattern.test('target string...')
```

`test()` æ–¹æ³•ç”¨äºåˆ¤æ–­æŸåŒ¹é…Pattern æ˜¯å¦èƒ½å¤ŸåŒ¹é…åˆ°ç›®æ ‡å†…å®¹ã€‚ è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚

ç¤ºä¾‹ ï¼š

```javascript
const str = 'I always love the moment you smile'
const exp = /love the moment/
exp.test(str) // true

const exp2 = /love the bala moment/
exp2.test(str) // false
```
